jQuery(document).ready(function(){if(!jQuery(".custom-columns-page-content").length)return!0;function i(e){e=e||jQuery(".column-wrapper"),$name=e.find(".name-field"),e.find(".column-title").length||e.prepend('<h3 class="column-title"><span class="text"></span> <i class="fa fa-chevron-down"></i></h3>'),e.find(".column-title .text").text($name.val())}jQuery(".select2").select2({tags:!0,selectOnBlur:!0}),jQuery("body").append('<div id="ohsnap" style="z-index: -1"></div>'),jQuery(".column-wrapper").each(function(){i(jQuery(this))}),jQuery("body").on("change",".column-wrapper .name-field",function(){var e=jQuery(this).parents(".column-wrapper"),t=(i(e),e.find(".key-field")),e=e.find(".name-field");!t.val()&&e.val()&&(e=(e=e.val()).replace(/(\d+)/gi,"").replace(/(\s+)/gi,"_").replace(/[^a-z\_]/gi,"_").toLowerCase(),t.val(e))}),jQuery("body").on("click",".column-title",function(){jQuery(this).parents(".column-wrapper").find(".column-fields-wrapper").slideToggle()}),1<($columnTitles=jQuery(".column-title")).length&&$columnTitles.trigger("click"),jQuery("body").on("click",".add-column",function(){jQuery(this).parents("form").find(".column-wrapper:not(:last)").find(".column-fields-wrapper:visible").each(function(){var e=jQuery(this);e.find(".name-field").val()&&e.slideToggle()}),jQuery(".mode-field").trigger("change"),jQuery(this).parents("form").find(".column-wrapper:last").find(".column-title .text").text(""),jQuery(".select2").select2({tags:!0,selectOnBlur:!0})}),jQuery(".repeater").repeater({initEmpty:!1,defaultValues:vg_sheet_editor_custom_columns.default_values,show:function(){jQuery(this).slideDown(),jQuery(this).find(".select2-container").remove(),jQuery(this).find("select.select2").select2({tags:!0,selectOnBlur:!0})},hide:function(e){confirm(vg_sheet_editor_custom_columns.texts.confirm_delete)&&jQuery(this).slideUp(e)},ready:function(e){},isFirstItemUndeletable:!1}),jQuery(".save").on("click",function(e){e.preventDefault(),loading_ajax({estado:!0});e=jQuery(this).parents("form");jQuery.post(e.attr("action"),e.serializeArray(),function(e){loading_ajax({estado:!1}),notification({tipo:e.success?"success":"error",mensaje:e.data})})}),jQuery(".mode-field").on("change",function(){var i=jQuery(this);["read-only","formulas","hide","rename","cell-type","plain-renderer","formatted-renderer","width","data-source"].forEach(function(e,t){e=".field-container-"+e;i.is(":checked")?jQuery(e).show():jQuery(e).hide()})}),jQuery(".mode-field").trigger("change")}),jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".modal-columns-visibility").length||!vgse_editor_settings.is_administrator)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wpse_rename_meta_key={name:vgse_editor_settings.texts.edit_meta_key,hidden:function(){var e;return!hot.getSelected()||(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],!vgse_editor_settings.is_administrator)||!e||"meta_data"!==e.data_type||e.serialized_field_settings},callback:function(e,t,i){var n,t=hot.colToProp(t[0].start.col);t=t,(n=prompt(vgse_editor_settings.texts.edit_meta_key,t))&&n!==t?(loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_rename_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,old_column_key:t,new_column_key:n},function(e){var t;loading_ajax(!1),e.success?(notification({mensaje:e.data.message}),t=vgse_editor_settings.texts.confirm_column_reload_page.replace("{columns}",e.data.key),confirm(t)&&(window.location.href=jQuery(".wpse-scan-db-link").attr("href")+"&wpse_dont_increase_limit=1")):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})):notification({mensaje:vgse_editor_settings.texts.new_value_empty_or_equal,tipo:"error",tiempo:1e4})}},e.items.wpse_delete_meta_key={name:vgse_editor_settings.texts.delete_meta_key,hidden:function(){var e;return!hot.getSelected()||(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],!vgse_editor_settings.is_administrator)||!e||"meta_data"!==e.data_type||e.serialized_field_settings||!e.allow_to_hide},callback:function(e,t,i){if(!confirm(vgse_editor_settings.texts.delete_meta_key_confirmation))return!0;vgseColumnsVisibilityInit();var s=[];t.forEach(function(e){for(var t=(e.start.col>e.end.col?e.end:e.start).col,i=(e.start.col>e.end.col?e.start:e.end).col,n=t;n<=i;n++)s.push(hot.colToProp(n))}),loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_delete_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,column_key:s},function(e){var t;loading_ajax(!1),e.success?(notification({mensaje:e.data.message}),t=jQuery(".modal-columns-visibility"),s.forEach(function(e){t.find('.columns-enabled .js-column-key[value="'+e+'"]').parent("li").appendTo(t.find(".columns-disabled"))}),t.find(".save_post_type_settings").prop("checked",!0),t.find("form").submit()):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})}},e.items.wpse_delete_serialized_meta_key={name:vgse_editor_settings.texts.delete_serialized_meta_key,hidden:function(){var e;return!(hot.getSelected()&&(e=hot.colToProp(hot.getSelected()[0][1]),e=vgse_editor_settings.final_spreadsheet_columns_settings[e],vgse_editor_settings.is_administrator)&&e&&"meta_data"===e.data_type&&e.serialized_field_original_key&&e.allow_to_hide)},callback:function(e,t,i){if(!confirm(vgse_editor_settings.texts.delete_serialized_meta_key_confirmation))return!0;vgseColumnsVisibilityInit();var t=hot.colToProp(t[0].start.col),s=vgse_editor_settings.final_spreadsheet_columns_settings[t].serialized_field_original_key;loading_ajax(!0),jQuery.post(vgse_global_data.ajax_url,{action:"vgse_delete_meta_key",nonce:jQuery("#vgse-wrapper").data("nonce"),post_type:vgse_editor_settings.post_type,column_key:s},function(e){if(loading_ajax(!1),e.success){notification({mensaje:e.data.message});var t,i=jQuery(".modal-columns-visibility"),n=[];for(t in vgse_editor_settings.final_spreadsheet_columns_settings)Object.hasOwnProperty.call(vgse_editor_settings.final_spreadsheet_columns_settings,t)&&vgse_editor_settings.final_spreadsheet_columns_settings[t].serialized_field_original_key===s&&(i.find('.columns-enabled .js-column-key[value="'+t+'"]').parent("li").appendTo(i.find(".columns-disabled")),n.push(t));n.length&&(i.find(".save_post_type_settings").prop("checked",!0),i.find("form").submit())}else notification({mensaje:e.data.message,tipo:"error",tiempo:6e4})})}},hot.updateSettings({contextMenu:e})});