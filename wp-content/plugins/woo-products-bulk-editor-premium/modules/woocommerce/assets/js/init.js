function vgseWcRegularPriceDecreaseNumberFormula(e){e=vgseGenerateDecreaseFormula(e);return!!e&&e.replace("..",".").replace(/\$current_value\$/g,"$_regular_price$")}function vgseWcRegularPriceDecreasePercentageFormula(e){e=vgseGenerateDecreasePercentageFormula(e);return!!e&&e.replace("..",".").replace(/\$current_value\$/g,"$_regular_price$")}jQuery(document).ready(function(){jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var e=window.vgseWCAttsCurrent;if(!e||"vgse_save_download_files"!==e.modalSettings.edit_modal_save_action)return!0;jQuery(".remodal.custom-modal-editor .vgse-copy-files-from-product-wrapper").remove()}),jQuery(document).on("opened",".remodal.custom-modal-editor",function(){var t=window.vgseWCAttsCurrent;if(!t||"vgse_save_download_files"!==t.modalSettings.edit_modal_save_action)return!0;setTimeout(function(){var e=($modal=jQuery(".remodal.custom-modal-editor")).find(".vgse-copy-files-from-product");$modal.find(".vgse-copy-files-from-product-trigger").on("click",function(){if(!e.val())return!0;loading_ajax({estado:!0}),jQuery.get(vgse_global_data.ajax_url,{nonce:e.data("nonce"),product_id:e.val(),action:"vgse_wc_get_downloadable_files"},function(e){e.success?initHandsontableForPopup(e.data,t.modalSettings):notification({mensaje:e.data.message,tipo:"error",tiempo:3e4}),loading_ajax({estado:!1})})})},400)})}),jQuery(document).ready(function(){"undefined"!=typeof vgseHooks&&vgseHooks().addFilter("vgSheetEditor_save_precheckErrors","vg_sheet_editor",function(e,t){var a,r;return"product"===vgse_editor_settings.post_type&&hot.propToCol("post_parent")&&(a=hot.getDataAtProp("ID"),r=[],t.forEach(function(e){var t;"product_variation"===e.post_type&&(t=a.indexOf(parseInt(e.ID)),hot.getDataAtRowProp(t,"post_parent")||r.push(e.ID))}),r.length)&&e.push(vgse_editor_settings.texts.variation_rows_missing_parent.replace("{variation_ids}",r.join(", "))),e}),jQuery("body").on("change",'input[name="copy_individual_variations"]',function(e){var t=jQuery(".vgse-copy-variation-from-product").val();jQuery(this).is(":checked")&&t&&(loading_ajax(!0),jQuery(".individual-variations-select").empty(),jQuery(".individual-variations-selector-wrapper").show(),jQuery.get(vgse_global_data.ajax_url,{action:"vgse_get_product_variations",nonce:jQuery(".remodal-bg").data("nonce"),product_id:t},function(e){loading_ajax(!1),e.success?e.data.length?e.data.forEach(function(e){jQuery(".individual-variations-select").append('<option value="'+e.ID+'">'+e.post_title+"</option>")}):alert(vgse_editor_settings.texts.product_without_variations):alert(e.data.message),vgseInitSelect2(jQuery(".individual-variations-select"))}))}),jQuery("body").on("change",".vgse-copy-variation-from-product",function(e){var t=jQuery(this).val(),a=jQuery(".link-variations-attributes, .link-variations-number");t?(a.parents("li").hide(),jQuery(".individual-variations-wrapper").show()):(a.parents("li").show(),jQuery(".individual-variations-wrapper").hide())}),jQuery("body").on("change",".link-variations-attributes",function(e){var t=jQuery(".link-variations-number");jQuery(this).is(":checked")?t.parents("li").hide():t.parents("li").show()}),jQuery("body").on("submit",".create-variation-modal form",function(e){var d,t,c,l,u=jQuery(this),p=jQuery(".vgse-variations-tool:visible");if("search"===u.find('select[name="vgse_variation_manager_source"]').val()&&!u.find('input[name="use_search_query"]:checked').length)return u.find('input[name="use_search_query"]').css("border","1px solid red"),!0;u.find('input[name="wpse_job_id"]').val(vgseGuidGenerator()),l="individual"===p.find('select[name="vgse_variation_manager_source"]').val()&&(2<p.find(".individual-product-selector").val().length||"copy"===p.find('input[name="vgse_variation_tool"]').val())?(p.find('select[name="vgse_variation_manager_source"]').val("search"),d=jQuery("body").data("be-filters"),t=[],p.find(".individual-product-selector").val().forEach(function(e){t.push(e.split("--")[1])}),jQuery("body").data("be-filters",{post__in:t.join(",")}),c=t.length,!0):(c=jQuery(".be-total-rows").text().match(/\d+/g).map(Number),!1),p.data("isPaginatedIndividualProductsOperation",l),"search"!==p.find('select[name="vgse_variation_manager_source"]').val()&&!u.find('input[name="use_search_query"]:checked').length||"function"!=typeof beGetRowsFilters||u.find('input[name="filters"]').val(beGetRowsFilters());var v,_,g,y,a,f,r=u.find("input,select,textarea").filter(function(){return jQuery(this).parents(".vgse-variations-tool").length&&jQuery(this).parents(".vgse-variations-tool").is(":visible")||!jQuery(this).parents(".vgse-variations-tool").length}).serializeArray();return"search"===p.find('select[name="vgse_variation_manager_source"]').val()||u.find('input[name="use_search_query"]:checked').length||"copy"===p.find('input[name="vgse_variation_tool"]').val()?(loading_ajax({estado:!1}),(v=p.find(".response")).before('<div id="be-variations-nanobar-container" />'),a={classname:"be-progress-bar",target:document.getElementById("be-variations-nanobar-container")},(_=new Nanobar(a)).go(1),(g=vgse_editor_settings.save_posts_per_page/2)<1&&(g=1),y="copy"===p.find('input[name="vgse_variation_tool"]').val()?vgse_editor_settings.texts.paged_copy_variations_preparation:vgse_editor_settings.texts.paged_batch_saved,"copy"===p.find('input[name="vgse_variation_tool"]').val()&&(a=(a=y.replace("{updated}",0)).replace("{total}",c),jQuery(v).empty().append("<p>"+a+"</p>")),f=0,window.wpseCreateVariationsLoop=beAjaxLoop({totalCalls:Math.ceil(c/parseInt(g)),url:u.attr("action"),method:u.attr("method"),data:r,onSuccess:function(e,t){if(loading_ajax({estado:!1}),!(e=!0===e.success||e.data?e:{data:{message:vgse_editor_settings.texts.http_error_try_now},success:!1}).success)return jQuery(v).append("<p>"+e.data.message+"</p>"),confirm(e.data.message)?(t.current=0,v.scrollTop(v[0].scrollHeight),!0):(jQuery(v).append(vgse_editor_settings.texts.saving_stop_error),v.scrollTop(v[0].scrollHeight),l&&d&&(jQuery("body").data("be-filters",""),jQuery("body").data("be-filters",d)),!1);e.data.force_complete&&(t.current=t.totalCalls),e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),_.go(t.current/t.totalCalls*100);var r,i,o,n,s,a=parseInt(g)*t.current>c?c:parseInt(g)*t.current,a=(a=y.replace("{updated}",a)).replace("{total}",c);return jQuery(v).empty().append("<p>"+a+"</p>"),f+=e.data.variations_count,t.current===t.totalCalls&&("copy"===p.find('input[name="vgse_variation_tool"]').val()?(a=u.find('input[name="wpse_job_id"]').val(),r=f,e=p,loading_ajax({estado:!1}),i=e.find(".response"),(o=e.parents("form")).find("#be-variations-nanobar-container").remove(),i.before('<div id="be-variations-nanobar-container" />'),t={classname:"be-progress-bar",target:document.getElementById("be-variations-nanobar-container")},(n=new Nanobar(t)).go(1),(t=vgse_editor_settings.wc_products_variation_copy_batch_size)<1&&(t=1),s=0,window.wpseCopyVariationsQueueLoop=beAjaxLoop({totalCalls:Math.ceil(r/parseInt(t)),url:e.parents("form").attr("action"),method:e.parents("form").attr("method"),data:{action:"vgse_process_copy_variations_queue",nonce:vgse_editor_settings.nonce,wpse_job_id:a,file_position:0},onSuccess:function(e,t){if(loading_ajax({estado:!1}),!(e=!0===e.success||e.data?e:{data:{message:vgse_editor_settings.texts.http_error_try_now},success:!1}).success)return jQuery(i).append("<p>"+e.data.message+"</p>"),confirm(e.data.message)?(t.current--,i.scrollTop(i[0].scrollHeight),!0):(jQuery(i).append(vgse_editor_settings.texts.saving_stop_error),i.scrollTop(i[0].scrollHeight),!1);e.data.force_complete&&(t.current=t.totalCalls),n.go(t.current/t.totalCalls*100),s+=e.data.created;var a=(a=e.data.message.replace("{total_created}",s)).replace("{total}",r);return jQuery(i).empty().append("<p>"+a+"</p>"),t.current===t.totalCalls&&(jQuery(i).append("<p>"+vgse_editor_settings.texts.everything_saved+"</p>"),loading_ajax({estado:!1}),notification({mensaje:vgse_editor_settings.texts.everything_saved}),i.find(".remodal-cancel").removeClass("hidden"),o.find("#be-variations-nanobar-container").remove()),t.data.file_position=e.data.file_position,setTimeout(function(){i.scrollTop(i[0].scrollHeight)},600),!0}})):(jQuery(v).append("<p>"+vgse_editor_settings.texts.everything_saved+"</p>"),loading_ajax({estado:!1}),notification({mensaje:vgse_editor_settings.texts.everything_saved}),v.find(".remodal-cancel").removeClass("hidden"),u.find("#be-variations-nanobar-container").remove()),l)&&d&&(jQuery("body").data("be-filters",""),jQuery("body").data("be-filters",d)),setTimeout(function(){v.scrollTop(v[0].scrollHeight)},600),!0}})):(loading_ajax({estado:!0}),jQuery.ajax({url:u.attr("action"),method:u.attr("method"),data:r}).done(function(e){loading_ajax({estado:!1}),e.success?(1<e.data.data.length&&vgAddRowsToSheet(e.data.data,"prepend",!0),e.data.deleted.length&&vgseRemoveRowFromSheetByID(e.data.deleted),notification({mensaje:e.data.message}),jQuery(window).scrollTop(jQuery(".be-spreadsheet-wrapper").offset().top-jQuery("#vg-header-toolbar").height()-20)):notification({mensaje:e.data.message,tipo:"error",tiempo:6e4}),jQuery(".create-variation-modal").remodal().close()})),!1})}),jQuery(document).ready(function(){jQuery(".vgse-current-filters").on("click",".button",function(e){"wc_display_variations"!==jQuery(this).data("filter-key")&&!jQuery(this).hasClass("remove-all-filters")||jQuery("#display-variations").prop("checked",!jQuery("#display-variations").prop("checked")).trigger("change")}),jQuery('.vgse-current-filters .button[data-filter-key="wc_display_variations"]').length&&jQuery("#display-variations").prop("checked",!0).trigger("change"),jQuery('.vgse-current-filters .button[data-filter-key="search_variations"]').length&&jQuery('#be-filters input[name="search_variations"]').prop("checked",!0).trigger("change");var e=jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]'),t=e.clone();e.remove(),jQuery('#be-filters input[name="search_variations"]').on("change",function(e){e.preventDefault(),jQuery(this).is(":checked")?(jQuery("#display-variations").prop("checked",!0).trigger("change"),jQuery(".wpse-advanced-filters-field-selector").append(t),"undefined"!=typeof Alpine&&Alpine.$data(document.querySelector('[x-data="bulkEdit"]'))&&(Alpine.$data(document.querySelector('[x-data="bulkEdit"]')).extra.wcRunBulkEditOnVariations="on"),jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]').show(),jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_pa_"]').hide()):(jQuery('.wpse-advanced-filters-field-selector option[value*="attribute_"]').hide(),"undefined"!=typeof Alpine&&Alpine.$data(document.querySelector('[x-data="bulkEdit"]'))&&(Alpine.$data(document.querySelector('[x-data="bulkEdit"]')).extra.wcRunBulkEditOnVariations=""))}),jQuery("#display-variations").on("change",function(e){var t=jQuery(this),t=(t.is(":checked")?jQuery("body").addClass("vg-variations-enabled"):jQuery("body").removeClass("vg-variations-enabled"),{wc_display_variations:t.is(":checked")?"yes":""});beAddRowsFilter(t)}),jQuery("#display-variations").on("click",function(e){var t=jQuery(this),a=beGetModifiedItems();if(a.length&&(a=t.is(":checked")?vgse_wc_attr_data.texts.variations_on_reload_needed:vgse_wc_attr_data.texts.variations_off_reload_needed,!confirm(a)))return!0;t.trigger("change"),vgseReloadSpreadsheet()}),jQuery('.vg-toolbar [name="display_all_variations"]').on("click",function(e){jQuery("#display-variations").click()}),jQuery('.vg-toolbar [name="display_selected_products_variations"], .vg-toolbar [name="only_display_selected_products_variations"]').on("click",function(e){var c=vgseGetSelectedIds(),l="only_display_selected_products_variations"===jQuery(this).attr("name");if(!c.length)return alert(vgse_editor_settings.texts.please_select_rows_with_checkboxes),!0;if(l){var t=beGetModifiedItems();if(t.length)if(!confirm(vgse_editor_settings.texts.save_changes_before_we_reload))return!1}loading_ajax(!0),c.chunk(vgse_editor_settings.posts_per_page).forEach(function(d){jQuery.get(vgse_global_data.ajax_url,{nonce:vgse_editor_settings.nonce,product_ids:d.join(","),action:"vgse_load_variations_per_product",post_type:"product"},function(e){if(loading_ajax(!1),e.data.rows&&e.data.rows.length){var a=[],t=null,r=null;if(e.data.rows.forEach(function(e){"product"===e.post_type?(a[e.ID]=[],t=e.ID):(a[t].push(e),r=e.ID)}),!r)return alert(vgse_editor_settings.texts.variations_not_found_for_selected_products.replace("{ids}",d.join(", "))),!0;var i,o,n=hot.getSourceData(),s=[],n=(l?(s=e.data.rows,window.beOriginalData=jQuery.extend(!0,[],s),jQuery("body").data("be-filters",""),beAddRowsFilter("post__in="+c.join(","))):(i=hot.getDataAtProp("ID"),o=0,n.forEach(function(e){var t;void 0!==a[e.ID]&&a[e.ID].length?(t=a[e.ID],s.push(e),o++,t.forEach(function(e){i.indexOf(e.ID)<0&&(s.push(e),window.beOriginalData.push(jQuery.extend(!0,{},e)))})):s.push(e)})),hot.loadData(s),jQuery("body").trigger("vgSheetEditor:afterRowsInsert",[e.data.rows,"append",!1]),vgseUpdateTableWrapperMinHeight(),d.length===o?vgse_editor_settings.texts.variations_displayed_successfully_for_selected_products.replace("{parentProductsWithVariationsCount}",o):vgse_editor_settings.texts.variations_displayed_for_selected_products.replace("{parentProductsWithVariationsCount}",o).replace("{parentProductsWithoutVariationsCount}",d.length-o));notification({mensaje:n,tipo:"success",tiempo:8e3})}else alert(vgse_editor_settings.texts.variations_not_found_for_selected_products.replace("{ids}",d.join(", ")))})})})}),wp.hooks.addFilter("vgseBulkEditExtra","wcModule",function(t,a){return t.wcRunBulkEditOnVariations="",t.runOnVariationsChanged=function(){var e=jQuery('#be-filters input[name="search_variations"]');e.prop("checked",!!t.wcRunBulkEditOnVariations),e.trigger("change"),t.wcRunBulkEditOnVariations?beAddRowsFilter("search_variations=yes"):beAddRowsFilter("search_variations="),window.wpseUpdateBulkEditRowsCount=!0,"current_search"===a.rowsSelectionType&&jQuery("#be-filters").submit()},t}),jQuery(document).ready(function(){jQuery("body").on("vgSheetEditor:beforeRowsInsert",function(e,t){if(void 0===t.data.total_inventory_price||void 0===t.data.total_inventory_price)return!0;jQuery("#responseConsole .wc-inventory-totals .item-value").html(t.data.total_inventory_units+" units ("+t.data.total_inventory_price+")")})}),jQuery(document).ready(function(){var a=jQuery(".vgse-variations-tool-selector");a.on("click",function(e){e.preventDefault();var t=jQuery(this).data("target"),t=(jQuery(".vgse-variations-tool").hide(),a.removeClass("active"),jQuery(this).addClass("active"),jQuery(t)),t=(t.show(),t.find("select.select2"));if(t.data("select2"))try{t.select2("destroy")}catch(e){}vgseInitSelect2(t.filter(function(){return jQuery(this).is(":visible")}))}),jQuery('[name="vgse_variation_manager_source"]').on("change",function(e){var t=jQuery(this).parents(".vgse-variations-tool"),a=jQuery(this).val(),a=(t.find(".use-search-query-container").hide(),t.find(".use-search-query-container").find("input:checkbox").prop("checked",!1),"search"===a?(t.find(".use-search-query-container").css("display","block"),t.find(".individual-product-selector").hide(),t.find(".individual-product-selector ~ .select2").hide(),window.vgseBackToVariationsTool=!0,jQuery('[name="run_filters"]').first().click()):"all"===a?(t.find(".use-search-query-container").hide(),t.find(".individual-product-selector").hide(),t.find(".use-search-query-container").find("input:checkbox").prop("checked",!0),t.find(".individual-product-selector ~ .select2").hide(),t.hasClass("vgse-create-variations")?(jQuery("body").data("be-filters",{"apply_to[]":"product_type--variable"}),vgseReloadSpreadsheet(!0)):vgseRemoveAllFilters()):("individual"===a&&(t.find(".individual-product-selector").show(),t.find(".individual-product-selector ~ .select2").show()),a||(t.find(".individual-product-selector").hide(),t.find(".individual-product-selector ~ .select2").hide())),t.find("select.select2"));vgseInitSelect2(a.filter(function(){return jQuery(this).is(":visible")}))}),jQuery(document).on("closed",'[data-remodal-id="modal-filters"]',function(){void 0!==window.vgseBackToVariationsTool&&window.vgseBackToVariationsTool&&(window.vgseBackToVariationsTool=!1,jQuery('[data-remodal-target="create-variation-modal"]').first().click())}),jQuery(".vgse-variations-tool .show-advanced-options").on("change",function(){jQuery(this).is(":checked")?jQuery(".vgse-variations-tool .advanced-options").show():jQuery(".vgse-variations-tool .advanced-options").hide()}),jQuery(document).on("closed",'[data-remodal-id="create-variation-modal"]',function(){jQuery('[data-remodal-id="create-variation-modal"]').find(".response").empty(),jQuery('[data-remodal-id="create-variation-modal"]').find("#be-variations-nanobar-container").remove();var e=jQuery(".vgse-variations-tool.vgse-copy-variations");"copy"===e.find('input[name="vgse_variation_tool"]').val()&&e.data("isPaginatedIndividualProductsOperation")&&e.find('[name="vgse_variation_manager_source"]').val("individual").trigger("change"),window.wpseCreateVariationsLoop&&window.wpseCreateVariationsLoop.pause(),window.wpseCopyVariationsQueueLoop&&window.wpseCopyVariationsQueueLoop.pause()})}),jQuery(document).ready(function(){if("undefined"==typeof hot||!jQuery(".create_variation-container").length)return!0;var e=hot.getSettings().contextMenu;void 0===e.items&&(e.items={}),e.items.wc_separator1={name:"---------"},e.items.wpse_create_variations={name:vgse_editor_settings.texts.create_variations,callback:function(e,t,a){var o,n;beGetModifiedItems().length?alert(vgse_editor_settings.texts.save_changes_before_we_reload):((o=jQuery(".create-variation-modal .vgse-create-variations").find(".individual-product-selector")).find("option").prop("selected",!1).trigger("change"),jQuery('select[name="vgse_variation_manager_source"]').val("individual").trigger("change"),n=[],t.forEach(function(e){for(var t=(e.start.row>e.end.row?e.end:e.start).row,a=(e.start.row>e.end.row?e.start:e.end).row,r=[],i=t;i<=a;i++)r.push(i);r.forEach(function(e){var t=parseInt(hot.getDataAtRowProp(e,"ID")),e=hot.getDataAtRowProp(e,"post_title"),t="product--"+t;n.push(t),o.find('option[value="'+t+'"]').length||o.append('<option value="'+t+'">'+e+"</option>")})}),o.val(n).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-create-variations"]').click()},800))}},e.items.wpse_copy_variations={name:vgse_editor_settings.texts.copy_variations,callback:function(e,t,a){var r,i;beGetModifiedItems().length?alert(vgse_editor_settings.texts.save_changes_before_we_reload):(i=parseInt(hot.getDataAtRowProp(t[0].start.row,"ID")),t=hot.getDataAtRowProp(t[0].start.row,"post_title"),(r=jQuery(".create-variation-modal .vgse-copy-variations .vgse-copy-variation-from-product")).append('<option value="'+(i="product--"+i)+'">'+t+"</option>"),r.val(i).trigger("change"),jQuery(".create_variation-container  button").click(),setTimeout(function(){jQuery('.create-variation-modal .vgse-variations-tool-selector[data-target=".vgse-copy-variations"]').click()},800))}},hot.updateSettings({contextMenu:e})});